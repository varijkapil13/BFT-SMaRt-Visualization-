<!DOCTYPE html>
<html lang="en">

<head>
	<title>BFT-Smart</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!--Bootstrap links start-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<!--Bootstrap files end-->


	<style>
		/*Style for first graph (Full system graph) starts*/
		
		.col-sm-2 {
			line-height: 20px;
			margin-top: 70px;
			width: 42%;
			margin-left: 5px;
		}
		
		.node rect {
			cursor: move;
			shape-rendering: crispEdges;
		}
		
		.node text {
			pointer-events: none;
			text-shadow: 1px 1px 2px #fff;
			font-size: 0.8em;
			font-family: sans-serif;
		}
		
		#tooltip {
			position: absolute;
			pointer-events: none;
			font-size: 0.7em;
			font-family: sans-serif;
			padding: 3px;
			width: auto;
			height: auto;
			background-color: #F2F2F2;
			-webkit-box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.4);
			-mox-box-shadow: 0px 0px 0px 5px rgba(0, 0, 0, 0.4);
			box-shadow: 0px 0px 5px rbga(0, 0, 0, 0.4);
			pointer-events: none;
		}
		
		.value {
			white-space: pre-line;
			margin: 0;
		}
		/*Style for first graph (Full system graph) ends*/
		/*Style for liquid gauge starts*/
		
		.liquidFillGaugeText {
			font-family: Helvetica;
			font-weight: bold;
			font-size: 29px;
		}
		/*Style for liquid gauge  starts*/
		/*Style for incoming and outgoing start*/
		
		body {
			font-size: 10px sans-serif !important;
		}
		
		.axis path,
		.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}
		
		.bar {
			fill: steelblue;
		}
		
		.x.axis path {
			display: none;
		}
		/*Style for incoming and outgoing ends*/
		/*Style for upstream and downstream starts*/
		
		.bar {
			fill: steelblue;
		}
		
		.axis text {
			font: 10px sans-serif;
		}
		
		.axis path,
		.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}
		
		.x.axis path {
			display: none;
		}
		/*Style for upstream and downstream ends*/
		/*Style for message graph starts*/
		
		.axis text {
			font: 10px sans-serif;
		}
		
		.chartTitle {
			font-size: 12px;
			font-weight: bold;
			text-anchor: middle;
		}
		
		.axis .title {
			font-weight: bold;
			text-anchor: middle;
		}
		
		.axis path,
		.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}
		
		.x.axis path {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}
		
		.nav .area {
			fill: lightgrey;
			stroke-width: 0px;
		}
		
		.nav .line {
			fill: none;
			stroke: darkgrey;
			stroke-width: 1px;
		}
		
		.viewport {
			stroke: grey;
			fill: black;
			fill-opacity: 0.3;
		}
		
		.viewport .extent {
			fill: green;
		}
		
		.well {
			padding-top: 0px;
			padding-bottom: 0px;
		}
		
		.node-message-box {
			float: left;
			width: 20px;
			height: 20px;
			margin: 5px;
			margin-left: 15px;
			border: 1px solid rgba(0, 0, 0, .2);
		}
		
		.node-message-text {
			float: left;
			width: 60px;
			height: 20px;
			margin: 5px;
			border: 1px solid rgba(0, 0, 0, .2);
		}
		
		.general {
			background: black;
		}
		
		.propose {
			background: red;
		}
		
		.write {
			background: blue;
		}
		
		.accept {
			background: green;
		}
		/*Style for message graph ends*/

	</style>


</head>

<body>

	<div class="container-fluid">
		<h1 style="text-align:center"> BFT-Smart Visualization</h1>
		<div class="row">
			<div class="col-sm-12">
				<div class="col-sm-6">
					<div id="chart"></div>
				</div>

				<div class="col-sm-6">

					<div class="col-sm-2">
						<div class="row container-fluid">
							<div class="col-sm-12">
								<div id="node1" class="panel panel-default" style="background-color:#7570b3;cursor:pointer;" onclick="fillheadertext('Node1');gauge1.update(cpuutilizationgauge(data0['cpupercent']));gauge2.update(memoryutilizationgauge(data0['totalvm'],data0['freevm']));fillupdatenetworkchart(data0['bytessent'],data0['bytesrec']);">
									<div class="panel-body">Server not running</div>
								</div>
							</div>
							<div class="col-sm-12">
								<div id="node2" class="panel panel-default" style="background-color:#e7298a;cursor:pointer;" onclick="fillheadertext('Node2');gauge1.update(cpuutilizationgauge(data1['cpupercent']));gauge2.update(memoryutilizationgauge(data1['totalvm'],data1['freevm']));fillupdatenetworkchart(data1['bytessent'],data1['bytesrec']);">
									<div class="panel-body">Server not running</div>
								</div>
							</div>
							<div class="col-sm-12">
								<div id="node3" class="panel panel-default" style="background-color:#62a01c;cursor:pointer;" onclick="fillheadertext('Node3');gauge1.update(cpuutilizationgauge(data2['cpupercent']));gauge2.update(memoryutilizationgauge(data2['totalvm'],data2['freevm']));fillupdatenetworkchart(data2['bytessent'],data2['bytesrec']);">
									<div class="panel-body">Server not running</div>
								</div>
							</div>
							<div class="col-sm-12">
								<div id="node4" class="panel panel-default" style="background-color:#e6ab02;cursor:pointer;" onclick="fillheadertext('Node4');gauge1.update(cpuutilizationgauge(data3['cpupercent']));gauge2.update(memoryutilizationgauge(data3['totalvm'],data3['freevm']));fillupdatenetworkchart(data3['bytessent'],data3['bytesrec']);">
									<div class="panel-body">Server not running</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-sm-4" id="newpost">
						<div class="row container-fluid">
							<div id="headertext" class="col-sm-12" style="text-align:center; font: normal bold 16px/30px Georgia, serif;position:relative; float:left;left:40%;white-space: nowrap;">System Stats</div>
							<div class="col-sm-12">
								<div class="col-sm-6" style="position:relative; float:left;left:70%;">
									<div style="position:relative; padding-left:103px; white-space: nowrap;font: normal bold 12px/30px Georgia, serif;">Cpu Utilization</div>
									<svg id="fillgauge1"></svg>



								</div>
								<div class="col-sm-6" style="position:relative; float:right;right:100%;">
									<div style="position:relative; padding-left:89px; white-space: nowrap;font: normal bold 12px/30px Georgia, serif;">Memory utilization</div>
									<svg id="fillgauge2"></svg>



								</div>
							</div>

							<div class="col-sm-12">
								<div style="position:relative; padding-left:111px;margin-top:8px; white-space: nowrap;font: normal bold 12px/30px Georgia, serif;">Network utilization</div>
								<svg id="inoutstream" width="97%" height="250" style="margin-top:0px;padding-left:-8px;"></svg>

							</div>


						</div>

					</div>



				</div>



			</div>
			<div class="col-sm-12">
				<div style="max-width: 900px; max-height: 400px; padding: 10px;position:relative; float:right;right:20%;">

					<div class="well">
						<h4>D3 Based Real Time Chart with Multiple Data Streams</h4>
					</div>
					<div class="row">
						<div class="node-message-box general"></div>
						<div class="node-message-text"> General </div>
						<div class="node-message-box propose"></div>
						<div class="node-message-text">Propose </div>
						<div class="node-message-box write"></div>
						<div class="node-message-text">Write </div>
						<div class="node-message-box accept"></div>
						<div class="node-message-text"> Accept</div>
						<input id="halt" type="checkbox" name="halt" value="halt" style="margin-bottom: 10px" />
						<div class="node-message-text"> Halt</div>
					</div>

					<div id="messageViewDiv"></div>

				</div>


			</div>
			<div class="col-sm-12" style="font-size:10px;position: relative;left:60px;margin-top:60px;">
				<div class="col-sm-6">
					<div id="incoming"></div>
					<div style="padding-left: 224px;font: normal bold 16px/30px Georgia, serif">Messages Sent</div>
				</div>
				<div class="col-sm-6">
					<div id="outgoing"></div>

					<div style="padding-left: 224px;font: normal bold 16px/30px Georgia, serif">Messages Received</div>
				</div>
			</div>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js"></script>
	<script>
		function fillheadertext(nodevalue) {
			var filltext = document.getElementById('headertext')
			filltext.innerHTML = "System Stats " + nodevalue;
			// var div = document.getElementById("newpost");
			//if (div.style.display !== "none") {
			//div.style.display = "none";
			//} else {
			//  div.style.display = "block";
			//}
		}

	</script>





	<!--js for column one -->
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="https://cdn.rawgit.com/Neilos/bihisankey/master/bihisankey.js"></script>
	<!--js for system diagram starts-->
	<script>
		'use strict';


		var svg, tooltip, biHiSankey, path, defs, colorScale, highlightColorScale, isTransitioning;




		/*var data0 = {
			"availablevm": 1615126528,
			"usedvm": 2121732096,
			"cpupercent": 0.8,
			"bytessent": 32632857,
			"bytesrec": 527771500,
			"packetsrecv": 416529,
			"packetssent": 309421,
			"freevm": 248623104,
			"id": "127.0.1.1",
			"totalvm": 4010278912
		}
		var data1 = {
			"availablevm": 100000,
			"usedvm": 2121732096,
			"cpupercent": 0.8,
			"bytessent": 32632857,
			"bytesrec": 527771500,
			"packetsrecv": 416529,
			"packetssent": 309421,
			"freevm": 248623104,
			"id": "127.0.1.1",
			"totalvm": 4010278912
		}

		var data2 = {
			"availablevm": 100000,
			"usedvm": 2121732096,
			"cpupercent": 0.8,
			"bytessent": 32632857,
			"bytesrec": 527771500,
			"packetsrecv": 416529,
			"packetssent": 309421,
			"freevm": 248623104,
			"id": "127.0.1.1",
			"totalvm": 4010278912
		}
		var data3 = {
			"availablevm": 1615126528,
			"usedvm": 2121732096,
			"cpupercent": 0.8,
			"bytessent": 32632857,
			"bytesrec": 527771500,
			"packetsrecv": 416529,
			"packetssent": 309421,
			"freevm": 248623104,
			"id": "127.0.1.1",
			"totalvm": 4010278912
		}

		var data4 = {
			"availablevm": 100000,
			"usedvm": 2121732096,
			"cpupercent": 0.8,
			"bytessent": 32632857,
			"bytesrec": 527771500,
			"packetsrecv": 416529,
			"packetssent": 309421,
			"freevm": 248623104,
			"id": "127.0.1.1",
			"totalvm": 4010278912
		}
		var data5 = {
			"availablevm": 100000,
			"usedvm": 2121732096,
			"cpupercent": 0.8,
			"bytessent": 32632857,
			"bytesrec": 527771500,
			"packetsrecv": 416529,
			"packetssent": 309421,
			"freevm": 248623104,
			"id": "127.0.1.1",
			"totalvm": 4010278912
		}*/

		//alert(data['availablevm']);

		var OPACITY = {
				NODE_DEFAULT: 0.9,
				NODE_FADED: 0.1,
				NODE_HIGHLIGHT: 0.8,
				LINK_DEFAULT: 0.6,
				LINK_FADED: 0.05,
				LINK_HIGHLIGHT: 0.9
			},
			TYPES = ["Client", "ClientManager", "Node1", "Node2", "Node3"],
			TYPE_COLORS = ["#1b9e77", "#d95f02", "#7570b3", "#e7298a", "#66a61e", "#e6ab02", "#a6761d"],
			TYPE_HIGHLIGHT_COLORS = ["#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3", "#a6d854", "#ffd92f", "#e5c494"],
			LINK_COLOR = "#b3b3b3",
			INFLOW_COLOR = "#2E86D1",
			OUTFLOW_COLOR = "#D63028",
			NODE_WIDTH = 40,
			COLLAPSER = {
				RADIUS: NODE_WIDTH / 2,
				SPACING: 20
			},
			OUTER_MARGIN = 10,
			MARGIN = {
				TOP: 2 * (COLLAPSER.RADIUS + OUTER_MARGIN),
				RIGHT: OUTER_MARGIN,
				BOTTOM: OUTER_MARGIN,
				LEFT: OUTER_MARGIN
			},
			TRANSITION_DURATION = 400,
			HEIGHT = 400 - MARGIN.TOP - MARGIN.BOTTOM,
			WIDTH = 790 - MARGIN.LEFT - MARGIN.RIGHT,
			LAYOUT_INTERATIONS = 32,
			REFRESH_INTERVAL = 7000;

		var formatNumber = function(d) {
				var numberFormat = d3.format(",.0f"); // zero decimal places
				return "£" + numberFormat(d);
			},

			formatFlow = function(d) {
				var flowFormat = d3.format(",.0f"); // zero decimal places with sign
				return "£" + flowFormat(Math.abs(d)) + (d < 0 ? " CR" : " DR");
			},

			// Used when temporarily disabling user interractions to allow animations to complete
			disableUserInterractions = function(time) {
				isTransitioning = true;
				setTimeout(function() {
					isTransitioning = false;
				}, time);
			},

			hideTooltip = function() {
				return tooltip.transition()
					.duration(TRANSITION_DURATION)
					.style("opacity", 0);
			},

			showTooltip = function() {
				return tooltip
					.style("left", d3.event.pageX + "px")
					.style("top", d3.event.pageY + 15 + "px")
					.transition()
					.duration(TRANSITION_DURATION)
					.style("opacity", 1);
			};

		colorScale = d3.scale.ordinal().domain(TYPES).range(TYPE_COLORS),
			highlightColorScale = d3.scale.ordinal().domain(TYPES).range(TYPE_HIGHLIGHT_COLORS),

			svg = d3.select("#chart").append("svg")
			.attr("width", WIDTH + MARGIN.LEFT + MARGIN.RIGHT)
			.attr("height", HEIGHT + MARGIN.TOP + MARGIN.BOTTOM)
			.append("g")
			.attr("transform", "translate(" + MARGIN.LEFT + "," + MARGIN.TOP + ")");

		svg.append("g").attr("id", "links");
		svg.append("g").attr("id", "nodes");
		svg.append("g").attr("id", "collapsers");

		tooltip = d3.select("#chart").append("div").attr("id", "tooltip");

		tooltip.style("opacity", 0)
			.append("p")
			.attr("class", "value");

		biHiSankey = d3.biHiSankey();

		// Set the biHiSankey diagram properties
		biHiSankey
			.nodeWidth(NODE_WIDTH)
			.nodeSpacing(10)
			.linkSpacing(4)
			.arrowheadScaleFactor(0.5) // Specifies that 0.5 of the link's stroke WIDTH should be allowed for the marker at the end of the link.
			.size([WIDTH, HEIGHT]);

		path = biHiSankey.link().curvature(0.45);

		defs = svg.append("defs");

		defs.append("marker")
			.style("fill", LINK_COLOR)
			.attr("id", "arrowHead")
			.attr("viewBox", "0 0 6 10")
			.attr("refX", "1")
			.attr("refY", "5")
			.attr("markerUnits", "strokeWidth")
			.attr("markerWidth", "1")
			.attr("markerHeight", "1")
			.attr("orient", "auto")
			.append("path")
			.attr("d", "M 0 0 L 1 0 L 6 5 L 1 10 L 0 10 z");

		defs.append("marker")
			.style("fill", OUTFLOW_COLOR)
			.attr("id", "arrowHeadInflow")
			.attr("viewBox", "0 0 6 10")
			.attr("refX", "1")
			.attr("refY", "5")
			.attr("markerUnits", "strokeWidth")
			.attr("markerWidth", "1")
			.attr("markerHeight", "1")
			.attr("orient", "auto")
			.append("path")
			.attr("d", "M 0 0 L 1 0 L 6 5 L 1 10 L 0 10 z");

		defs.append("marker")
			.style("fill", INFLOW_COLOR)
			.attr("id", "arrowHeadOutlow")
			.attr("viewBox", "0 0 6 10")
			.attr("refX", "1")
			.attr("refY", "5")
			.attr("markerUnits", "strokeWidth")
			.attr("markerWidth", "1")
			.attr("markerHeight", "1")
			.attr("orient", "auto")
			.append("path")
			.attr("d", "M 0 0 L 1 0 L 6 5 L 1 10 L 0 10 z");

		function update() {
			var link, linkEnter, node, nodeEnter, collapser, collapserEnter;

			function dragmove(node) {
				node.x = Math.max(0, Math.min(WIDTH - node.width, d3.event.x));
				node.y = Math.max(0, Math.min(HEIGHT - node.height, d3.event.y));
				d3.select(this).attr("transform", "translate(" + node.x + "," + node.y + ")");
				biHiSankey.relayout();
				svg.selectAll(".node").selectAll("rect").attr("height", function(d) {
					return d.height;
				});
				link.attr("d", path);
			}

			function containChildren(node) {
				node.children.forEach(function(child) {
					child.state = "contained";
					child.parent = this;
					child._parent = null;
					containChildren(child);
				}, node);
			}

			function expand(node) {
				node.state = "expanded";
				node.children.forEach(function(child) {
					child.state = "collapsed";
					child._parent = this;
					child.parent = null;
					containChildren(child);
				}, node);
			}

			function collapse(node) {
				node.state = "collapsed";
				containChildren(node);
			}

			function restoreLinksAndNodes() {
				link
					.style("stroke", LINK_COLOR)
					.style("marker-end", function() {
						return 'url(#arrowHead)';
					})
					.transition()
					.duration(TRANSITION_DURATION)
					.style("opacity", OPACITY.LINK_DEFAULT);

				node
					.selectAll("rect")
					.style("fill", function(d) {
						d.color = colorScale(d.type.replace(/ .*/, ""));
						return d.color;
					})
					.style("stroke", function(d) {
						return d3.rgb(colorScale(d.type.replace(/ .*/, ""))).darker(0.1);
					})
					.style("fill-opacity", OPACITY.NODE_DEFAULT);

				node.filter(function(n) {
						return n.state === "collapsed";
					})
					.transition()
					.duration(TRANSITION_DURATION)
					.style("opacity", OPACITY.NODE_DEFAULT);
			}

			function showHideChildren(node) {
				disableUserInterractions(2 * TRANSITION_DURATION);
				hideTooltip();
				if (node.state === "collapsed") {
					expand(node);
				} else {
					collapse(node);
				}

				biHiSankey.relayout();
				update();
				link.attr("d", path);
				restoreLinksAndNodes();
			}

			function highlightConnected(g) {
				link.filter(function(d) {
						return d.source === g;
					})
					.style("marker-end", function() {
						return 'url(#arrowHeadInflow)';
					})
					.style("stroke", OUTFLOW_COLOR)
					.style("opacity", OPACITY.LINK_DEFAULT);

				link.filter(function(d) {
						return d.target === g;
					})
					.style("marker-end", function() {
						return 'url(#arrowHeadOutlow)';
					})
					.style("stroke", INFLOW_COLOR)
					.style("opacity", OPACITY.LINK_DEFAULT);
			}

			function fadeUnconnected(g) {
				link.filter(function(d) {
						return d.source !== g && d.target !== g;
					})
					.style("marker-end", function() {
						return 'url(#arrowHead)';
					})
					.transition()
					.duration(TRANSITION_DURATION)
					.style("opacity", OPACITY.LINK_FADED);

				node.filter(function(d) {
						return (d.name === g.name) ? false : !biHiSankey.connected(d, g);
					}).transition()
					.duration(TRANSITION_DURATION)
					.style("opacity", OPACITY.NODE_FADED);
			}

			link = svg.select("#links").selectAll("path.link")
				.data(biHiSankey.visibleLinks(), function(d) {
					return d.id;
				});

			link.transition()
				.duration(TRANSITION_DURATION)
				.style("stroke-WIDTH", function(d) {
					return Math.max(1, d.thickness);
				})
				.attr("d", path)
				.style("opacity", OPACITY.LINK_DEFAULT);


			link.exit().remove();


			linkEnter = link.enter().append("path")
				.attr("class", "link")
				.style("fill", "none");

			linkEnter.on('mouseenter', function(d) {
				if (!isTransitioning) {
					showTooltip().select(".value").text(function() {
						if (d.direction > 0) {
							return d.source.name + " → " + d.target.name + "\n" + formatNumber(d.value);
						}
						return d.target.name + " ← " + d.source.name + "\n" + formatNumber(d.value);
					});

					d3.select(this)
						.style("stroke", LINK_COLOR)
						.transition()
						.duration(TRANSITION_DURATION / 2)
						.style("opacity", OPACITY.LINK_HIGHLIGHT);
				}
			});

			linkEnter.on('mouseleave', function() {
				if (!isTransitioning) {
					hideTooltip();

					d3.select(this)
						.style("stroke", LINK_COLOR)
						.transition()
						.duration(TRANSITION_DURATION / 2)
						.style("opacity", OPACITY.LINK_DEFAULT);
				}
			});

			linkEnter.sort(function(a, b) {
					return b.thickness - a.thickness;
				})
				.classed("leftToRight", function(d) {
					return d.direction > 0;
				})
				.classed("rightToLeft", function(d) {
					return d.direction < 0;
				})
				.style("marker-end", function() {
					return 'url(#arrowHead)';
				})
				.style("stroke", LINK_COLOR)
				.style("opacity", 0)
				.transition()
				.delay(TRANSITION_DURATION)
				.duration(TRANSITION_DURATION)
				.attr("d", path)
				.style("stroke-WIDTH", function(d) {
					return Math.max(1, d.thickness);
				})
				.style("opacity", OPACITY.LINK_DEFAULT);


			node = svg.select("#nodes").selectAll(".node")
				.data(biHiSankey.collapsedNodes(), function(d) {
					return d.id;
				});


			node.transition()
				.duration(TRANSITION_DURATION)
				.attr("transform", function(d) {
					return "translate(" + d.x + "," + d.y + ")";
				})
				.style("opacity", OPACITY.NODE_DEFAULT)
				.select("rect")
				.style("fill", function(d) {
					d.color = colorScale(d.type.replace(/ .*/, ""));
					return d.color;
				})
				.style("stroke", function(d) {
					return d3.rgb(colorScale(d.type.replace(/ .*/, ""))).darker(0.1);
				})
				.style("stroke-WIDTH", "1px")
				.attr("height", function(d) {
					return d.height;
				})
				.attr("width", biHiSankey.nodeWidth());


			node.exit()
				.transition()
				.duration(TRANSITION_DURATION)
				.attr("transform", function(d) {
					var collapsedAncestor, endX, endY;
					collapsedAncestor = d.ancestors.filter(function(a) {
						return a.state === "collapsed";
					})[0];
					endX = collapsedAncestor ? collapsedAncestor.x : d.x;
					endY = collapsedAncestor ? collapsedAncestor.y : d.y;
					return "translate(" + endX + "," + endY + ")";
				})
				.remove();


			nodeEnter = node.enter().append("g").attr("class", "node");

			nodeEnter
				.attr("transform", function(d) {
					var startX = d._parent ? d._parent.x : d.x,
						startY = d._parent ? d._parent.y : d.y;
					return "translate(" + startX + "," + startY + ")";
				})
				.style("opacity", 1e-6)
				.transition()
				.duration(TRANSITION_DURATION)
				.style("opacity", OPACITY.NODE_DEFAULT)
				.attr("transform", function(d) {
					return "translate(" + d.x + "," + d.y + ")";
				});

			nodeEnter.append("text");
			nodeEnter.append("rect")
				.style("fill", function(d) {
					d.color = colorScale(d.type.replace(/ .*/, ""));
					return d.color;
				})
				.style("stroke", function(d) {
					return d3.rgb(colorScale(d.type.replace(/ .*/, ""))).darker(0.1);
				})
				.style("stroke-WIDTH", "1px")
				.attr("height", function(d) {
					return d.height;
				})
				.attr("width", biHiSankey.nodeWidth());
			//nodeEnter.append("div");  

			node.on("mouseenter", function(g) {
				if (!isTransitioning) {
					restoreLinksAndNodes();
					highlightConnected(g);
					fadeUnconnected(g);

					d3.select(this).select("rect")
						.style("fill", function(d) {
							d.color = d.netFlow > 0 ? INFLOW_COLOR : OUTFLOW_COLOR;
							return d.color;
						})
						.style("stroke", function(d) {
							return d3.rgb(d.color).darker(0.1);
						})
						.style("fill-opacity", OPACITY.LINK_DEFAULT);

					tooltip
						.style("left", g.x + MARGIN.LEFT + "px")
						.style("top", g.y + g.height + MARGIN.TOP + 15 + "px")
						.transition()
						.duration(TRANSITION_DURATION)
						.style("opacity", 1).select(".value")
						.text(function() {
							var additionalInstructions = g.children.length ? "\n(Double click to expand)" : "";
							return g.name + "\nNet flow: " + formatFlow(g.netFlow) + additionalInstructions;
						});
				}
			});

			node.on("mouseleave", function() {
				if (!isTransitioning) {
					hideTooltip();
					restoreLinksAndNodes();
				}
			});

			node.filter(function(d) {
					return d.children.length;
				})
				.on("dblclick", showHideChildren);

			// allow nodes to be dragged to new positions
			node.call(d3.behavior.drag()
				.origin(function(d) {
					return d;
				})
				.on("dragstart", function() {
					this.parentNode.appendChild(this);
				})
				.on("drag", dragmove));

			// add in the text for the nodes
			node.filter(function(d) {
					return d.value !== 0;
				})
				.select("text")
				.attr("x", -6)
				.attr("y", function(d) {
					return d.height / 2;
				})
				.attr("dy", ".35em")
				.attr("text-anchor", "end")
				.attr("transform", null)
				.text(function(d) {
					return d.name;
				})
				.filter(function(d) {
					return d.x < WIDTH / 2;
				})
				.attr("x", 6 + biHiSankey.nodeWidth())
				.attr("text-anchor", "start");

			/* node.filter(function (d) { return d.value !== 0; })
			 .select("div")
			   .attr("x", -6)
			   .attr("y", function (d) { return d.height / 2; })
			   .attr("dy", ".35em")
			   .attr("text-anchor", "end")
			   .attr("transform", null)
			   .html(function (d) { return d.cpu; })
			 .filter(function (d) { return d.x < WIDTH / 2; })
			   .attr("x", 6 + biHiSankey.nodeWidth())
			   .attr("text-anchor", "start");*/

			//alert(node.filter(function (d) { return d.value });








			collapser = svg.select("#collapsers").selectAll(".collapser")
				.data(biHiSankey.expandedNodes(), function(d) {
					return d.id;
				});


			collapserEnter = collapser.enter().append("g").attr("class", "collapser");

			collapserEnter.append("circle")
				.attr("r", COLLAPSER.RADIUS)
				.style("fill", function(d) {
					d.color = colorScale(d.type.replace(/ .*/, ""));
					return d.color;
				});

			collapserEnter
				.style("opacity", OPACITY.NODE_DEFAULT)
				.attr("transform", function(d) {
					return "translate(" + (d.x + d.width / 2) + "," + (d.y + COLLAPSER.RADIUS) + ")";
				});

			collapserEnter.on("dblclick", showHideChildren);

			collapser.select("circle")
				.attr("r", COLLAPSER.RADIUS);

			collapser.transition()
				.delay(TRANSITION_DURATION)
				.duration(TRANSITION_DURATION)
				.attr("transform", function(d, i) {
					return "translate(" +
						(COLLAPSER.RADIUS + i * 2 * (COLLAPSER.RADIUS + COLLAPSER.SPACING)) +
						"," +
						(-COLLAPSER.RADIUS - OUTER_MARGIN) +
						")";
				});

			collapser.on("mouseenter", function(g) {
				if (!isTransitioning) {
					showTooltip().select(".value")
						.text(function() {
							return g.name + "\n(Double click to collapse)";
						});

					var highlightColor = highlightColorScale(g.type.replace(/ .*/, ""));

					d3.select(this)
						.style("opacity", OPACITY.NODE_HIGHLIGHT)
						.select("circle")
						.style("fill", highlightColor);

					node.filter(function(d) {
							return d.ancestors.indexOf(g) >= 0;
						}).style("opacity", OPACITY.NODE_HIGHLIGHT)
						.select("rect")
						.style("fill", highlightColor);
				}
			});

			collapser.on("mouseleave", function(g) {
				if (!isTransitioning) {
					hideTooltip();
					d3.select(this)
						.style("opacity", OPACITY.NODE_DEFAULT)
						.select("circle")
						.style("fill", function(d) {
							return d.color;
						});

					node.filter(function(d) {
							return d.ancestors.indexOf(g) >= 0;
						}).style("opacity", OPACITY.NODE_DEFAULT)
						.select("rect")
						.style("fill", function(d) {
							return d.color;
						});
				}
			});

			collapser.exit().remove();


		}



		var exampleNodes = [{
				"type": "Client",
				"id": "cl",
				"parent": null,
				"number": "1",
				"name": "Client"

			},
			{
				"type": "ClientManager",
				"id": "clm",
				"parent": null,
				"number": "2",
				"name": "ClientManager"

			},
			{
				"type": "Node1",
				"id": "n1",
				"parent": null,
				"number": "3",
				"name": "Node1"

			},
			{
				"type": "Node2",
				"id": "n2",
				"parent": null,
				"number": "4",
				"name": "Node2"

			},
			{
				"type": "Node3",
				"id": "n3",
				"parent": null,
				"number": "5",
				"name": "Node3"

			},
			{
				"type": "Node4",
				"id": "n4",
				"parent": null,
				"number": "6",
				"name": "Node4"

			}


		]
		//alert(exampleNodes[1].type);
		/*var resArr = exampleNodes.map(function(x){
		    alert( x[Object.keys(x)[1]]);
		});*/


		var exampleLinks = [{
				"source": "cl",
				"target": "clm",
				"value": 5
			},

			{
				"source": "cl",
				"target": "n1",
				"value": 5
			},
			{
				"source": "cl",
				"target": "n2",
				"value": 5
			},
			{
				"source": "cl",
				"target": "n3",
				"value": 5
			},
			{
				"source": "cl",
				"target": "n4",
				"value": 5
			},

			/*{"source":"n1", "target":"cl", "value":10},    
			{"source":"n2", "target":"cl", "value":10},
			{"source":"n3", "target":"cl", "value":10},    
			{"source":"n4", "target":"cl", "value":10},*/

			{
				"source": "clm",
				"target": "n1",
				"value": 5
			},
			{
				"source": "clm",
				"target": "n2",
				"value": 5
			},
			{
				"source": "clm",
				"target": "n3",
				"value": 5
			},
			{
				"source": "clm",
				"target": "n4",
				"value": 5
			},


		]



		biHiSankey
			.nodes(exampleNodes)
			.links(exampleLinks)
			.initializeNodes(function(node) {
				node.state = node.parent ? "contained" : "collapsed";
			})
			.layout(LAYOUT_INTERATIONS);

		disableUserInterractions(2 * TRANSITION_DURATION);

		/*function testing() {
			var div = document.createElement("foreignObject");
			div.style.visibility = 'visible';
			div.innerHTML = '<span class="msg">Hello world how are u</span>';
			document.getElementsByClassName("node")[0].appendChild(div);
			//rootElement.getElementsByClassName("node").appendChild(div);
		}

		function testing2() {

			var el = document.getElementsByClassName('node');
			for (var i = 0; i < el.length; i++) {
				var fo = document.createElementNS("http://www.w3.org/2000/svg", "foreignObject");
				fo.setAttribute("id", "y");
				fo.setAttribute("x", "200");
				fo.setAttribute("y", "300");
				fo.setAttribute("width", "300");
				fo.setAttribute("height", "100");
				var ta = document.createElement("div");
				ta.className = "test";

				var datata = document.getElementsByClassName('node');

				for (var j = 0; j < el.length; j++) {
					ta.innerHTML = data0['availablevm'];

				}
				fo.appendChild(ta);
				el[i].appendChild(fo);
			}

		}*/

		function networkutilization(rec, sent) {
			var bytesrec = data0['bytesrec'];
			var bytessent = data0['bytessent'];
			var y = 8;
			var Z = 100;
			var totalnetworkutilization = (bytesrec + bytessent) * y * Z;
			//alert(totalnetworkutilization);
			return totalnetworkutilization;

		}

		function memoryutilization(totalvm, freevm) {
			var total = totalvm;
			var free = freevm;

			var totalmemoryutilization = (total - free) / total * 100;
			var n = totalmemoryutilization.toFixed(2);
			//alert(totalnetworkutilization);
			return n;

		}

		function networkutilizationrec(bytesrec) {
			var bytesrecone = bytesrec;
			var bytesreconeinkb = bytesrecone / 1024;
			var bytesreconeinmb = (bytesreconeinkb / 1024).toFixed(1);
			return bytesreconeinmb;

		}

		function networkutilizationsent(bytessent) {
			var bytessentone = bytessent;
			var bytessentoneinkb = bytessentone / 1024;
			var bytessentoneinmb = (bytessentoneinkb / 1024).toFixed(1);
			return bytessentoneinmb;

		}


		function filldata() {
			var fillnode1 = document.getElementById('node1');
			fillnode1.innerHTML = "CPU Utilization : " + data0['cpupercent'] + "%" + "<br/>" + "Up/Down : " + networkutilizationsent(data0['bytessent']) + "/" + networkutilizationrec(data0['bytesrec']) + " MB" + "<br/>" +
				"Memory Utilization : " + memoryutilization(data0['totalvm'], data0['freevm']) + "%";
			var fillnode2 = document.getElementById('node2');
			fillnode2.innerHTML = "CPU Utilization : " + data1['cpupercent'] + "%" + "<br/>" + "Up/Down : " + networkutilizationsent(data1['bytessent']) + "/" + networkutilizationrec(data1['bytesrec']) + " MB" + "<br/>" +
				"Memory Utilization : " + memoryutilization(data1['totalvm'], data1['freevm']) + "%";
			var fillnode3 = document.getElementById('node3');
			fillnode3.innerHTML = "CPU Utilization : " + data2['cpupercent'] + "%" + "<br/>" + "Up/Down : " + networkutilizationsent(data2['bytessent']) + "/" + networkutilizationrec(data2['bytesrec']) + " MB" + "<br/>" +
				"Memory Utilization : " + memoryutilization(data2['totalvm'], data2['freevm']) + "%";
			var fillnode4 = document.getElementById('node4');
			fillnode4.innerHTML = "CPU Utilization : " + data3['cpupercent'] + "%" + "<br/>" + "Up/Down" + networkutilizationsent(data3['bytessent']) + "/" + networkutilizationrec(data3['bytesrec']) + " MB" + "<br/>" +
				"Memory Utilization : " + memoryutilization(data3['totalvm'], data3['freevm']) + "%";


		}


		update();


		var data0, data1, data2, data3;
		var socket = io();
		var replyData = {
			"sample": "valeu"
		};
		socket.on('systemstat', function(msg) {
			replyData = JSON.parse(msg);
			//console.log("socketdata", replyData['cpupercent']);

			if (replyData['ip'] == "192.168.12.27") {
				data0 = replyData;
			} else if (replyData['ip'] == "192.168.12.29") {
				data1 = replyData;
			} else if (replyData['ip'] == "192.168.12.30") {
				data2 = replyData;
			} else if (replyData['ip'] == "192.168.12.61") {
				data3 = replyData;
			}

			filldata();
		});

	</script>
	<!--js for system diagram ends-->
	<!--js for gauge diagrams starts-->
	<script src="http://person-elite.com/lionLikeWebService/kafka/liquidFillGauge.js"></script>
	<!--js for gauge diagrams ends-->
	<!--js for gauge data starts-->
	<script language="JavaScript">
		var gauge1 = loadLiquidFillGauge("fillgauge1", 0, config1);
		var config1 = liquidFillGaugeDefaultSettings();
		config1.circleThickness = 0.05;
		config1.circleColor = "#6DA398";
		config1.textColor = "#0E5144";
		config1.waveTextColor = "#6DA398";
		config1.waveColor = "#246D5F";
		config1.textVertPosition = 0.52;
		config1.waveAnimateTime = 5000;
		config1.waveHeight = 0;
		config1.waveAnimate = false;
		config1.waveCount = 2;
		config1.waveOffset = 0.25;
		config1.textSize = 1.0;
		config1.minValue = 30;
		config1.maxValue = 150
		config1.displayPercent = true;

		var gauge2 = loadLiquidFillGauge("fillgauge2", 0, config2);
		var config2 = liquidFillGaugeDefaultSettings();
		config2.circleThickness = 0.1;
		config2.circleColor = "#6DA398";
		config2.textColor = "#0E5144";
		config2.waveTextColor = "#6DA398";
		config2.waveColor = "#246D5F";
		config2.textVertPosition = 0.52;
		config2.waveAnimateTime = 5000;
		config2.waveHeight = 0;
		config2.waveAnimate = false;
		config2.waveCount = 2;
		config2.waveOffset = 0.25;
		config2.textSize = 1.2;
		config2.minValue = 30;
		config2.maxValue = 150
		config2.displayPercent = true;


		function cpuutilizationgauge(cpuutilnode) {
			var cpuutil = cpuutilnode;
			return cpuutil;

		}

		function memoryutilizationgauge(nodetotalvm, nodefreevm) {
			var memoryutil = memoryutilization(nodetotalvm, nodefreevm);
			return memoryutil;

		}

	</script>
	<!--js for gauge data ends-->

	<!--script for incoming -->
	<script>
		'use strict';
		var zerotoone, zerototwo, zerotothree, zerotoclient, onetozero, onetotwo, onetothree, onetoclient, twotozero, twotoone, twotothree, twotoclient, threetozero, threetoone, threetotwo, threetoclient;

		var socket = io();


		socket.on('messages-sent', function(msgsent) {

			zerotoone = 0;
			zerototwo = 0;
			zerotothree = 0;
			zerotoclient = 0;
			onetozero = 0;
			onetotwo = 0;
			onetothree = 0;
			onetoclient = 0;
			twotozero = 0;
			twotoone = 0;
			twotothree = 0;
			twotoclient = 0;
			threetozero = 0;
			threetoone = 0;
			threetotwo = 0;
			threetoclient = 0;

			var messagesent = msgsent;
			//console.log("messagelengthafter", messagesent.length);
			var i;

			for (i = 0; i < messagesent.length; i++) {

				if (messagesent[i].sender == 0) {
					if (messagesent[i].receiver == 1) {
						zerotoone++;
					} else if (messagesent[i].receiver == 2) {
						zerototwo++;
					} else if (messagesent[i].receiver == 3) {
						zerotothree++;
					} else if (messagesent[i].receiver == 1001) {
						zerotoclient++;
					}
				} else if (messagesent[i].sender == 1) {
					if (messagesent[i].receiver == 0) {
						onetozero++;
					} else if (messagesent[i].receiver == 2) {
						onetotwo++;
					} else if (messagesent[i].receiver == 3) {
						onetothree++;
					} else if (messagesent[i].receiver == 1001) {
						onetoclient++;
					}
				} else if (messagesent[i].sender == 2) {
					if (messagesent[i].receiver == 0) {
						twotozero++;
					} else if (messagesent[i].receiver == 1) {
						twotoone++;
					} else if (messagesent[i].receiver == 3) {
						twotothree++;
					} else if (messagesent[i].receiver == 1001) {
						twotoclient++;
					}
				} else if (messagesent[i].sender == 3) {
					if (messagesent[i].receiver == 0) {
						threetozero++;
					} else if (messagesent[i].receiver == 1) {
						threetoone++;
					} else if (messagesent[i].receiver == 2) {
						threetotwo++;
					} else if (messagesent[i].receiver == 1001) {
						threetoclient++;
					}
				}



			}

			var messagesentdata = [{
				key: 'Node1',
				values: [{
					key: 'Node2',
					value: zerotoone
				}, {
					key: 'Node3',
					value: zerototwo
				}, {
					key: 'Node4',
					value: zerotothree
				}, {
					key: 'Client',
					value: zerotoclient
				}]
			}, {
				key: 'Node2',
				values: [{
					key: 'Node1',
					value: onetotwo
				}, {
					key: 'Node3',
					value: onetotwo
				}, {
					key: 'Node4',
					value: onetothree
				}, {
					key: 'Client',
					value: onetoclient
				}]
			}, {
				key: 'Node3',
				values: [{
					key: 'Node1',
					value: twotozero
				}, {
					key: 'Node2',
					value: twotoone
				}, {
					key: 'Node4',
					value: twotothree
				}, {
					key: 'Client',
					value: twotoclient
				}]
			}, {
				key: 'Node4',
				values: [{
					key: 'Node1',
					value: threetozero
				}, {
					key: 'Node2',
					value: threetoone
				}, {
					key: 'Node3',
					value: threetotwo
				}, {
					key: 'Client',
					value: threetoclient
				}]
			}];

			var margin = {
					top: 20,
					right: 20,
					bottom: 60,
					left: 40
				},
				width = 560 - margin.left - margin.right,
				height = 360 - margin.top - margin.bottom;
			var color = {
				Node1: '#7570b3',
				Node2: '#e7298a',
				Node3: '#62a01c',
				Node4: '#e6ab02'
			};
			var barPadding = 40;

			var rangeBands = [];
			var cummulative = 0;
			messagesentdata.forEach(function(val, i) {
				val.cummulative = cummulative;
				cummulative += val.values.length;
				val.values.forEach(function(values) {
					values.parentKey = val.key;
					rangeBands.push(i);
				})
			});
			//console.log(data);

			var x_category = d3.scale.linear()
				.range([0, width]);


			var x_defect = d3.scale.ordinal().domain(rangeBands).rangeRoundBands([0, width], .1);
			var x_category_domain = x_defect.rangeBand() * rangeBands.length;
			x_category.domain([0, x_category_domain]);


			var y = d3.scale.linear()
				.range([height, 0]);

			y.domain([0, d3.max(messagesentdata, function(cat) {
				return d3.max(cat.values, function(def) {
					return def.value;
				});
			})]);

			var category_axis = d3.svg.axis()
				.scale(x_category)
				.orient("bottom");

			var yAxis = d3.svg.axis()
				.scale(y)
				.orient("left")
				.tickFormat(d3.format(".2s"));

			var messagesentchartremove = d3.select("#incoming");
			var messagesentchartdelete = messagesentchartremove.selectAll("*").remove();

			var svg = d3.select("#incoming").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.style('background-color', 'EFEFEF')
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			svg.append("g")
				.attr("class", "y axis")
				.call(yAxis)
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end")
				.text("Value");

			var category_g = svg.selectAll(".category")
				.data(messagesentdata)
				.enter().append("g")
				.attr("class", function(d) {
					return 'category category-' + d.key;
				})
				.attr("transform", function(d) {
					return "translate(" + x_category((d.cummulative * x_defect.rangeBand())) + ",0)";
				})
				.attr("fill", function(d) {
					//console.log("color", d.key);
					return color[d.key];
				});

			var category_label = category_g.selectAll(".category-label")
				.data(function(d) {
					return [d];
				})
				.enter().append("text")
				.attr("class", function(d) {
					//console.log(d)
					return 'category-label category-label-' + d.key;
				})
				.attr("transform", function(d) {
					var x_label = x_category((d.values.length * x_defect.rangeBand() + barPadding) / 2);
					var y_label = height + 30;
					return "translate(" + x_label + "," + y_label + ")";
				})
				.text(function(d) {
					return d.key;
				})
				.attr('text-anchor', 'middle');

			var defect_g = category_g.selectAll(".defect")
				.data(function(d) {
					return d.values;
				})
				.enter().append("g")
				.attr("class", function(d) {
					return 'defect defect-' + d.key;
				})
				.attr("transform", function(d, i) {
					return "translate(" + x_category((i * x_defect.rangeBand())) + ",0)";
				});

			var defect_label = defect_g.selectAll(".defect-label")
				.data(function(d) {
					return [d];
				})
				.enter().append("text")
				.attr("class", function(d) {
					//console.log(d)
					return 'defect-label defect-label-' + d.key;
				})
				.attr("transform", function(d) {
					var x_label = x_category((x_defect.rangeBand() + barPadding) / 2);
					var y_label = height + 10;
					return "translate(" + x_label + "," + y_label + ")";
				})
				.text(function(d) {
					return d.key;
				})
				.attr('text-anchor', 'middle');


			var rects = defect_g.selectAll('.rect')
				.data(function(d) {
					return [d];
				})
				.enter().append("rect")
				.attr("class", "rect")
				.attr("width", x_category(x_defect.rangeBand() - barPadding))
				.attr("x", function(d) {
					return x_category(barPadding);
				})
				.attr("y", function(d) {
					return y(d.value);
				})
				.attr("height", function(d) {
					return height - y(d.value);
				});

		});

	</script>
	<!--script for incoming ends-->

	<!--script for outgoing starts -->
	<script>
		'use strict';
		var zerotooneout, zerototwoout, zerotothreeout, zerotoclientout, onetozeroout, onetotwoout, onetothreeout, onetoclientout, twotozeroout, twotooneout, twotothreeout, twotoclientout, threetozeroout, threetooneout, threetotwoout, threetoclientout;

		var socket = io();


		socket.on('messages-rec', function(msgrec) {

			zerotooneout = 0;
			zerototwoout = 0;
			zerotothreeout = 0;
			zerotoclientout = 0;
			onetozeroout = 0;
			onetotwoout = 0;
			onetothreeout = 0;
			onetoclientout = 0;
			twotozeroout = 0;
			twotooneout = 0;
			twotothreeout = 0;
			twotoclientout = 0;
			threetozeroout = 0;
			threetooneout = 0;
			threetotwoout = 0;
			threetoclientout = 0;

			var messagerec = msgrec;
			//console.log("messagelengthafter", messagerec.length);
			var i;

			for (i = 0; i < messagerec.length; i++) {

				if (messagerec[i].receiver == 0) {
					if (messagerec[i].sender == 1) {
						zerotooneout++;
					} else if (messagerec[i].sender == 2) {
						zerototwoout++;
					} else if (messagerec[i].sender == 3) {
						zerotothreeout++;
					} else if (messagerec[i].sender == 1001) {
						zerotoclientout++;
					}
				} else if (messagerec[i].receiver == 1) {
					if (messagerec[i].sender == 0) {
						onetozeroout++;
					} else if (messagerec[i].sender == 2) {
						onetotwoout++;
					} else if (messagerec[i].sender == 3) {
						onetothreeout++;
					} else if (messagerec[i].sender == 1001) {
						onetoclientout++;
					}
				} else if (messagerec[i].receiver == 2) {
					if (messagerec[i].sender == 0) {
						twotozeroout++;
					} else if (messagerec[i].sender == 1) {
						twotooneout++;
					} else if (messagerec[i].sender == 3) {
						twotothreeout++;
					} else if (messagerec[i].sender == 1001) {
						twotoclientout++;
					}
				} else if (messagerec[i].receiver == 3) {
					if (messagerec[i].sender == 0) {
						threetozeroout++;
					} else if (messagerec[i].sender == 1) {
						threetooneout++;
					} else if (messagerec[i].sender == 2) {
						threetotwoout++;
					} else if (messagerec[i].sender == 1001) {
						threetoclientout++;
					}
				}



			}

			var messagerecdata = [{
				key: 'Node1',
				values: [{
					key: 'Node2',
					value: zerotooneout
				}, {
					key: 'Node3',
					value: zerototwoout
				}, {
					key: 'Node4',
					value: zerotothreeout
				}, {
					key: 'Client',
					value: zerotoclientout
				}]
			}, {
				key: 'Node2',
				values: [{
					key: 'Node1',
					value: onetotwoout
				}, {
					key: 'Node3',
					value: onetotwoout
				}, {
					key: 'Node4',
					value: onetothreeout
				}, {
					key: 'Client',
					value: onetoclientout
				}]
			}, {
				key: 'Node3',
				values: [{
					key: 'Node1',
					value: twotozeroout
				}, {
					key: 'Node2',
					value: twotooneout
				}, {
					key: 'Node4',
					value: twotothreeout
				}, {
					key: 'Client',
					value: twotoclientout
				}]
			}, {
				key: 'Node4',
				values: [{
					key: 'Node1',
					value: threetozeroout
				}, {
					key: 'Node2',
					value: threetooneout
				}, {
					key: 'Node3',
					value: threetotwoout
				}, {
					key: 'Client',
					value: threetoclientout
				}]
			}];

			var margin = {
					top: 20,
					right: 20,
					bottom: 60,
					left: 40
				},
				width = 560 - margin.left - margin.right,
				height = 360 - margin.top - margin.bottom;
			var color = {
				Node1: '#7570b3',
				Node2: '#e7298a',
				Node3: '#62a01c',
				Node4: '#e6ab02'
			};
			var barPadding = 40;

			var rangeBands = [];
			var cummulative = 0;
			messagerecdata.forEach(function(val, i) {
				val.cummulative = cummulative;
				cummulative += val.values.length;
				val.values.forEach(function(values) {
					values.parentKey = val.key;
					rangeBands.push(i);
				})
			});
			//console.log(data);

			var x_category = d3.scale.linear()
				.range([0, width]);


			var x_defect = d3.scale.ordinal().domain(rangeBands).rangeRoundBands([0, width], .1);
			var x_category_domain = x_defect.rangeBand() * rangeBands.length;
			x_category.domain([0, x_category_domain]);


			var y = d3.scale.linear()
				.range([height, 0]);

			y.domain([0, d3.max(messagerecdata, function(cat) {
				return d3.max(cat.values, function(def) {
					return def.value;
				});
			})]);

			var category_axis = d3.svg.axis()
				.scale(x_category)
				.orient("bottom");

			var yAxis = d3.svg.axis()
				.scale(y)
				.orient("left")
				.tickFormat(d3.format(".2s"));

			var messagerecchartremove = d3.select("#outgoing");
			var messagerecchartdelete = messagerecchartremove.selectAll("*").remove();

			var svg = d3.select("#outgoing").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.style('background-color', 'EFEFEF')
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			svg.append("g")
				.attr("class", "y axis")
				.call(yAxis)
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end")
				.text("Value");

			var category_g = svg.selectAll(".category")
				.data(messagerecdata)
				.enter().append("g")
				.attr("class", function(d) {
					return 'category category-' + d.key;
				})
				.attr("transform", function(d) {
					return "translate(" + x_category((d.cummulative * x_defect.rangeBand())) + ",0)";
				})
				.attr("fill", function(d) {
					//console.log("color", d.key);
					return color[d.key];
				});

			var category_label = category_g.selectAll(".category-label")
				.data(function(d) {
					return [d];
				})
				.enter().append("text")
				.attr("class", function(d) {
					//console.log(d)
					return 'category-label category-label-' + d.key;
				})
				.attr("transform", function(d) {
					var x_label = x_category((d.values.length * x_defect.rangeBand() + barPadding) / 2);
					var y_label = height + 30;
					return "translate(" + x_label + "," + y_label + ")";
				})
				.text(function(d) {
					return d.key;
				})
				.attr('text-anchor', 'middle');

			var defect_g = category_g.selectAll(".defect")
				.data(function(d) {
					return d.values;
				})
				.enter().append("g")
				.attr("class", function(d) {
					return 'defect defect-' + d.key;
				})
				.attr("transform", function(d, i) {
					return "translate(" + x_category((i * x_defect.rangeBand())) + ",0)";
				});

			var defect_label = defect_g.selectAll(".defect-label")
				.data(function(d) {
					return [d];
				})
				.enter().append("text")
				.attr("class", function(d) {
					//console.log(d)
					return 'defect-label defect-label-' + d.key;
				})
				.attr("transform", function(d) {
					var x_label = x_category((x_defect.rangeBand() + barPadding) / 2);
					var y_label = height + 10;
					return "translate(" + x_label + "," + y_label + ")";
				})
				.text(function(d) {
					return d.key;
				})
				.attr('text-anchor', 'middle');


			var rects = defect_g.selectAll('.rect')
				.data(function(d) {
					return [d];
				})
				.enter().append("rect")
				.attr("class", "rect")
				.attr("width", x_category(x_defect.rangeBand() - barPadding))
				.attr("x", function(d) {
					return x_category(barPadding);
				})
				.attr("y", function(d) {
					return y(d.value);
				})
				.attr("height", function(d) {
					return height - y(d.value);
				});

		});

	</script>
	<!--script for outgoing ends-->

	<!--script for instrream and outstream starts-->
	<script>
		// The new data variable.
		window.onload = fillupdatenetworkchart(0, 0);

		function fillupdatenetworkchart(upstreamfromnode, downstreamfromnode) {

			var updata = upstreamfromnode;
			var updatainkb = (updata / 1024) / 1024;
			var upstream = updatainkb.toFixed(2);


			var downdata = downstreamfromnode;
			var downdatainkb = (downdata / 1024) / 1024;
			var downstream = downdatainkb.toFixed(2);





			var data = [{
				letter: "Upstream",
				frequency: upstream
			}, {
				letter: "Downstream",
				frequency: downstream
			}];

			var margin = {
					top: 60,
					right: 80,
					bottom: 30,
					left: 50
				},
				width = 460 - margin.left - margin.right,
				height = 250 - margin.top - margin.bottom;

			var x = d3.scale.ordinal()
				.rangeRoundBands([0, width], .1);

			var y = d3.scale.linear()
				.range([height, 0]);

			var xAxis = d3.svg.axis()
				.scale(x)
				.orient("bottom");

			var yAxis = d3.svg.axis()
				.scale(y)
				.orient("left");
			var removeerChart = d3.select("#inoutstream");
			var removeChartGraph = removeerChart.selectAll("*").remove();
			var chart = d3.select("#inoutstream")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");


			x.domain(data.map(function(d) {
				return d.letter;
			}));
			y.domain([0, d3.max(data, function(d) {
				return d.frequency;
			})]);

			chart.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			chart.append("g")
				.attr("class", "y axis")
				.call(yAxis);

			chart.selectAll(".bar")
				.data(data)
				.enter().append("rect")
				.attr("class", "bar")
				.attr("x", function(d) {
					return x(d.letter);
				})
				.attr("y", function(d) {
					return y(d.frequency);
				})
				.attr("height", function(d) {
					return height - y(d.frequency);
				})
				.attr("width", x.rangeBand());



		}

		function type(d) {
			d.value = +d.frequency; // coerce to number
			return d;
		}

	</script>
	<!--script for instream and outstream ends -->

	<!--script for message flow starts-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
	<!-- Author: Bo Ericsson, bo@boe.net -->
	<!-- Inspiration from numerous examples by Mike Bostock, http://bl.ocks.org/mbostock, -->
	<!-- and example by Andy Aiken, http://blog.scottlogic.com/2014/09/19/interactive.html -->
	<script src="http://person-elite.com/lionLikeWebService/kafka/kennedy.js"></script>
	<script>
		'use strict';

		//var socket = io();
		var messageFlowData;
		socket.on('new-message', function(msg) {
			messageFlowData = JSON.parse(msg);
			//console.log("socketdata", replyData['cpupercent']);

			var messageFlowSender = messageFlowData['sender'];
			var messageFlowReceiver = messageFlowData['receiver'];



			filldata();
		});
		// create the real time chart
		var chart = realTimeChartMulti()
			.title("Message Exchange Between Nodes")
			.yTitle("Nodes")
			.xTitle("Time")
			.yDomain(["Node 4", "Node 3", "Node 2", "Node 1", "Client"]) // initial y domain (note array)
			.border(true)
			.width(900)
			.height(350);

		// invoke the chart
		var chartDiv = d3.select("#messageViewDiv").append("div")
			.attr("id", "chartDiv")
			.call(chart);

		// event handler for halt checkbox
		d3.select("#halt").on("change", function() {
			var state = d3.select(this).property("checked")
			chart.halt(state);
		})



		socket.on('new-message', function(msg) {

			messageFlowData = JSON.parse(msg);
			var categoryNamesFlowMessages = {
				0: "Node 1",
				1: "Node 2",
				2: "Node 3",
				3: "Node 4",
			}
			var messageTypeFlowMessages = {
				Normal: "black",
				propose: "red",
				accept: "green",
				write: "blue",
			}

			var messageFlowSender = messageFlowData['sender'];
			var messageFlowReceiver = messageFlowData['receiver'];
			var messageFlowTimeReceived = messageFlowData['time-recieved'];
			var messageFlowTimeSent;


			var senderNodeCategory, receiverNodecategory;

			if (messageFlowReceiver == 1001) {
				receiverNodecategory = "Client";
			} else {
				receiverNodecategory = categoryNamesFlowMessages[messageFlowReceiver];
			}

			var colorcategoryForLineFlowMessage = messageTypeFlowMessages[messageFlowData['type']];


			var messageFlowSentTime = new Date(0);
			var messageFlowSReceivedTime = new Date(0);

			if (!messageFlowData['time-sent']) {
				messageFlowTimeSent = messageFlowTimeReceived;
				messageFlowSentTime.setUTCMilliseconds(messageFlowTimeSent);
				console.log("time sent", messageFlowSentTime);
				messageFlowSentTime.setSeconds(messageFlowSentTime.getSeconds() - 3);
			} else {
				messageFlowTimeSent = messageFlowData['time-sent'];
				messageFlowSentTime.setUTCMilliseconds(messageFlowTimeSent);
				console.log("time sent", messageFlowSentTime);
				messageFlowSentTime.setSeconds(messageFlowSentTime.getSeconds() - 3);
			}


			messageFlowSReceivedTime.setUTCMilliseconds(messageFlowTimeReceived);
			console.log("time rec", messageFlowSReceivedTime);
			if (messageFlowSender == 1001) {
				senderNodeCategory = "Client";
				messageFlowSentTime.setSeconds(messageFlowSentTime.getSeconds() - 7);
				messageFlowSReceivedTime.setSeconds(messageFlowSReceivedTime.getSeconds() - 5);
				console.log("time rec", messageFlowSReceivedTime);
			} else {
				senderNodeCategory = categoryNamesFlowMessages[messageFlowSender];
			}

			var messageFlowObjectToChart = {
				time: messageFlowSentTime, // sent time
				category: senderNodeCategory, // sender Node
				type: "circle", // optional (defaults to circle)
				color: colorcategoryForLineFlowMessage, // optional (defaults to black)
				opacity: 0.8, // optional (defaults to 1)
				size: 8, // optional (defaults to 6)
				category2: receiverNodecategory, // receiver node
				time2: messageFlowSReceivedTime, // received time
				lineColor: colorcategoryForLineFlowMessage, // color of the message based on type of message
			};

			chart.datum(messageFlowObjectToChart);

		});

	</script>

	<!--script for message flow ends-->







</body>

</html>
